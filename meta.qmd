---
title: "Meta Data"
format: 
  html:
     code-fold: true
     code-summary: "Show the code"
---

```{r}
#| include=FALSE

library(knitr)
library(tidyverse)
library(iBats)
library(gt)


```

Many columns would be added to a tidy data set so it becomes more useful for analysis; some of these are described below.

## Date and Time Information

### The *Night*

Bats are active through the night; the date of the night is the date at sunset and lasts until sunrise the morning of the following day. The *Night* is a variable column that is added to the *tidy* data; it is useful convention that helps avoid the confusion of having contiguous bat activity over two dates.

The *Night* can be obtained from the *iBats* package using the `date_time_info` function. It requires a data.frame or tibble with a `DateTime` column, the *iana*[^1] time zone can be specified; the default is `Europe/London`.

[^1]: a full list of time zones can be found here <https://en.wikipedia.org/wiki/List_of_tz_database_time_zones>

The code below takes the `statics` set from the *iBats* package and adds the *Night* column, @tbl-night shows a random selection of 5 rows from the `statics` data.

```{r}
#| code-fold: show


statics_with_night <- iBats::date_time_info(statics)

```

```{r}
#| label: tbl-night
#| tbl-cap: "The Night from the DateTime Column"

statics_with_night %>% 
  sample_n(5) %>% 
  select(Description, Night, DateTime, Species) %>% 
  # Table made with library(gt)
  gt() %>% 
  tab_style(
    style = list(
      cell_fill(color = "midnightblue"),
      cell_text(color = "white"),
      cell_text(weight = "normal")
      ),
    locations = cells_body(
      columns = Night
    )
  ) %>% 
  tab_style(
    style = list(
      cell_fill(color = "midnightblue"),
      cell_text(color = "white"),
      cell_text(weight = "bold")
      ),
    locations = cells_column_labels(
      columns = Night
    )
  )
```

### Other Date and Time Information added

The function `iBats::date_time_info()` adds other date and time information: month, year and time see @tbl-other (note: not all columns are shown). @tbl-other shows a random selection of 5 rows from the `statics` set.

```{r}
#| label: tbl-other
#| tbl-cap: "Other Date and Time Information from the DateTime Column"

statics_with_night %>% 
  sample_n(5) %>% 
  select(Description, Month, MonthFull, Year, JustTime, DateTime, Species) %>% 
  #Table made with library(gt)
  gt() %>% 
  tab_style(
    style = list(
      cell_fill(color = "lightcyan"),
      cell_text(color = "black"),
      cell_text(weight = "normal")
      ),
    locations = cells_body(
      columns = c(Month, MonthFull, Year, JustTime)
    )
  ) %>% 
  tab_style(
    style = list(
      cell_fill(color = "lightcyan"),
      cell_text(color = "black"),
      cell_text(weight = "bold")
      ),
    locations = cells_column_labels(
      columns = c(Month, MonthFull, Year, JustTime)
    )
  )
```
